name: Build Android APK

on:
  push:
    branches:
      - main
      - master

jobs:
  build:
    name: Build APK
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install Dependencies
        run: npm install

      # ğŸ’¡ Ú¯Ø§Ù… Ø¬Ø¯ÛŒØ¯: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ù„ØªÙØ±Ù… Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯ Capacitor 
      # Ø§ÛŒÙ† Ú©Ø§Ø± Ù…Ø·Ù…Ø¦Ù† Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ 'android' Ø¨Ø±Ø§ÛŒ Capacitor Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.
      - name: Add Capacitor Android Platform
        run: npx cap add android

      - name: Build Web Assets
        # Ø§Ú¯Ø± Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨ÛŒÙ„Ø¯ ÙˆØ¨ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²Ù†Ø¯ØŒ Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ ØªØ¹Ø±ÛŒÙ Ø´ÙˆÙ†Ø¯.
        # ØªÙˆØ¬Ù‡: Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ Ø¯Ø± React Native (Ø¨Ù‡ ÙˆÛŒÚ˜Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨ÛŒÙ„Ø¯ ÙˆØ¨) Ú¯Ø§Ù‡ÛŒ Ø§ÙˆÙ‚Ø§Øª Ø¨Ø§ÛŒØ¯ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¯Ø± Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨ÛŒÙ„Ø¯ Ù‡Ù†Ø¯Ù„ Ø´ÙˆÙ†Ø¯.
        env:
          VITE_API_KEY: ${{ secrets.VITE_API_KEY }}
        run: npm run build

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          
      # ğŸ’¡ Ú¯Ø§Ù… Ø¬Ø¯ÛŒØ¯: Setup Gradle Cache
      # Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ø§Ø¹Ø« Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±Ø¹Øª Ø¨ÛŒÙ„Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      - name: Setup Gradle Cache
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      - name: Sync Capacitor
        # Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø§Ú©Ù†ÙˆÙ† Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ 'build' (Ú©Ù‡ Ø¨Ø§ npm run build Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡) Ø±Ø§ 
        # Ø¨Ø§ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ 'android' (Ú©Ù‡ Ø¨Ø§ npx cap add android Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡) Ø³ÛŒÙ†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
        run: npx cap sync android

      - name: Build APK with Gradle
        run: |
          cd android
          chmod +x gradlew
          # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² --no-daemon Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¯Ø± Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§ÛŒ CI Ù¾Ø§ÛŒØ¯Ø§Ø±ØªØ± Ø¨Ø§Ø´Ø¯
          ./gradlew assembleDebug --no-daemon

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: class-manager-apk
          path: android/app/build/outputs/apk/debug/app-debug.apk




# name: Android CI

# on:
#   push:
#     branches:
#       - main  # ÛŒØ§ Ù‡Ø± Ø¨Ø±Ù†Ú† Ø¯ÛŒÚ¯Ø±ÛŒ Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨ÛŒÙ„Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯
#   workflow_dispatch:

# jobs:
#   build:
#     runs-on: ubuntu-latest
    
  

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Set up Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '18'

#       - name: Install dependencies
#         run: npm install

#       # --- Ù…Ø±Ø­Ù„Ù‡ Ø­ÛŒØ§ØªÛŒ Ø¬Ø¯ÛŒØ¯: Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ Ù¾ÙˆØ´Ù‡ web ---
#       - name: Create Dummy Web Directory for Capacitor Sync
#         run: mkdir -p web && touch web/index.html 
#         # Ù…Ø§ Ù¾ÙˆØ´Ù‡ web Ùˆ index.html Ø±Ø§ Ø¯Ø± CI Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ØªØ§ npx cap sync Ø®Ø·Ø§ Ù†Ø¯Ù‡Ø¯

#       # --- Ù…Ø±Ø­Ù„Ù‡ Ø­ÛŒØ§ØªÛŒ Ø¬Ø¯ÛŒØ¯: Ù‡Ù…Ú¯Ø§Ù… Ø³Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯ Ø¯Ø± CI ---
#       - name: Run Capacitor Sync (to generate missing Gradle files)
#         run: npx cap sync android
#         # Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± Ø¨Ø§ÛŒØ¯ ÙØ§ÛŒÙ„ Ù‡Ø§ÛŒ Ú¯Ù…Ø´Ø¯Ù‡ Ù…Ø«Ù„ cordova.variables.gradle Ø±Ø§ ØªÙˆÙ„ÛŒØ¯ Ú©Ù†Ø¯.
        
#       - name: Make gradlew executable
#         run: chmod +x android/gradlew

#       - name: Build Android Release (APK)
#         # ØªÙˆØ¬Ù‡: Ø§Ú¯Ø± Ø¨ÛŒÙ„Ø¯ Ù‡Ù†ÙˆØ² Ø®Ø·Ø§ Ø¯Ø§Ø¯ØŒ Ø¨Ø§ÛŒØ¯ ./gradlew Ø±Ø§ Ø¯Ø± Ù‡Ù…ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ùˆ Ø¯Ø± Ø±ÛŒØ´Ù‡ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒÙ…ØŒ Ù†Ù‡ cd android && ./gradlew
#         # Ø§Ù…Ø§ ÙØ¹Ù„Ø§ Ù‡Ù…Ø§Ù† Ø±ÙˆØ´ Ù‚Ø¨Ù„ Ø±Ø§ Ù†Ú¯Ù‡ Ù…ÛŒâ€ŒØ¯Ø§Ø±ÛŒÙ…
#         run: cd android && ./gradlew assembleRelease
   
     

#       - name: Add Capacitor Android Platform (if needed)
#         run: npx cap add android || true # Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ØŒ Ø®Ø·Ø§ Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ø¯

        
#       - name: Create React Native JS Bundle
#         run: |
#           npx react-native bundle --platform android \
#           --dev false \
#           --entry-file index.js \
#           --bundle-output android/app/src/main/assets/index.android.bundle \
#           --assets-dest android/app/src/main/res/
#       # --- Ø¨Ø®Ø´ Ø¨ÛŒÙ„Ø¯ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯ ---
#       - name: Make gradlew executable
#         run: chmod +x android/gradlew

#       - name: Build Android Debug (APK)
#         run: cd android && ./gradlew assembleDebug

#       - name: Upload Debug APK
#         uses: actions/upload-artifact@v4
#         with:
#           name: app-debug-apk
#           # Ù…Ø³ÛŒØ± Ø¨ÛŒÙ„Ø¯ debug Ù…Ø¹Ù…ÙˆÙ„Ø§ Ø§ÛŒÙ† Ø§Ø³Øª:
#           path: android/app/build/outputs/apk/debug/app-debug.apk
